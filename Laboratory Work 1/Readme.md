# Лабораторная работа 1
> K33401 - Рейнгеверц Вадим


## Выполнение

### 1. Выберите 2 тематических сообщества

#### "A" group
Group ID: ij_salt

Owner ID: -204380239

![](https://i.imgur.com/OMgukiH.png)


#### "B" group
Group ID: itmem

Owner ID: -127149194

![](https://i.imgur.com/86oXhVa.png)


### 2. Сохраните списки участников выбранных сообществ
> Есть ли пользователи, относящиеся к обоим сообществам?


#### Сохранение

Для сохранения списков использовался браузерный Session Storage API

"A" group users

![](https://i.imgur.com/VbPwYJ9.png)

"B" group users

![](https://i.imgur.com/qCHTC92.png)

[Релевантный сниппет](core/main.js#L30)

![](https://i.imgur.com/G6YYm6H.png)

Функции `fetchAndStoreData`, `fetchAllItems`, `fetchFromVk` определены в [core/utils.js](core/utils.js)


#### Пересечение 
> 131 участника

![](https://i.imgur.com/zTZZXjE.png)

[Релевантный сниппет](core/main.js#L71)

![](https://i.imgur.com/EWh1W7r.png)


### 3. Сохраните последние 2000 постов каждого из сообществ
> - Ничего страшного, если их вдруг чуть меньше, в таком случае берём все, что есть
> - Используются ли в постах хэштеги? 
>   - Если используются, то составьте топ хэштегов по встречаемости для каждой группы, визуализируйте полученные результаты.
>   - Сравните списки на предмет пересечений.

#### Сохранение
Так как у Session Storage API есть общий лимит в 5 mb и по количеству символов у одного ключа, в него не получилось сохранить 2000 постов.

В качестве альтернативы был использован IndexedDB API, позволяющий, помимо прочего, хранить объекты напрямую, а не в виде строки.

Так как работать напрямую с IndexedDB - это плохая идея, была использована вспомогательная библиотека Dexie.


"A" group posts

![](https://i.imgur.com/0xTmukT.png)

"B" group posts

![](https://i.imgur.com/fhFr2hZ.png)

[Релевантный сниппет](core/main.js#L100)

![](https://i.imgur.com/J82fROV.png)

#### Экстракция хештегов



"A" group hashtags

![](https://i.imgur.com/J9V65Tl.png)

"B" group hashtags

![](https://i.imgur.com/D230JHJ.png)

[Релевантный сниппет](core/main.js#L146)

![](https://i.imgur.com/9SlziGt.png)

Так как пересечений нет, визуализировать особо нечего

![](https://i.imgur.com/c7kMkQT.png)


### 4. Посчитайте количество постов за каждый час суток для обоих сообществ
> - Визуализируйте результаты
> - В какое время суток наиболее активны участники социальных групп? 
> - Совпадают ли часы с наибольшей активностью для обоих сообществ?

![](https://i.imgur.com/K0uzpDn.png)

У обеих групп с 10:00 до 23:00 поддерживается максимальный уровень активности

Однако у группы "A" активность дольше держится в районе максимума: дополнительно в 9:00, и в 00:00; когда как у группы "B" активность в это время уже падает наполовину

[Релевантный сниппет](core/main.js#L192)

![](https://i.imgur.com/PUqlpl8.png)

### 5. Постройте социальные графы для обоих сообществ
> - Если во 2 пункте пересечений не было обнаружено, постройте 2 отдельных графа
> - Если пересечения по пользователям всё же есть, смотрите на то, насколько большие сообщества вы взяли
> - Графы можно объединить в 1 или исследовать по отдельности, если общий граф тяжело воспринимать визуально
>

Попытка отобразить графы обоих сообществ

![](https://i.imgur.com/cNfUiYR.jpeg)


После ограничения количества пользователей до 5000, показа только одной группы и отключение отображения меток

![](https://i.imgur.com/PCiAhCs.png)


После уменьшения размера нод и связей

"B" группа 

![](https://i.imgur.com/kqivgYl.jpeg)


"A" группа

![](https://i.imgur.com/MOBPlv9.jpeg)


[Релевантный сниппет](core/main.js#L306)

![](https://i.imgur.com/ohWX0t0.png)

### 6. Сколько узлов получилось в каждом из графов? 
> А сколько рёбер?


Связями брались дружба пользователей группы, для их нахождения делался запрос для получения всех друзей каждого пользователя, и далее сравнивался с другими участниками группы.

В итоге в обрезанной версии "A" группы, получилось 5000 нод и 952 связи, а в обрезанной версии "B" группы, получилось 5000 нод и 37768 связей

В процессе был достигнут лимит на общее количество запросов (где-то ~7000), и нужно было ждать пару дней, чтобы он полностью восстановился 

Так же возникали проблемы с производительностью, связанные с тесной связянностью пользователей в группе "B", и результируем количестве ребер. На моем примере, у меня 1 друг в группе "A" и 20 друзей в группе "B"

### 7. При помощи кластеризации выделите сообщества внутри обоих графов
> - Сколько сообществ получилось выделить в исследуемых графах?
> - Внутри крупной социальной группы, как правило, можно выделить небольшие сообщества
>   - Например, в учебной группе часто есть несколько небольших компаний друзей
>   - В получившихся после выполнения предыдущего пункта социальных графах выделите такие сообщества, применив кластеризацию. 


Кластеризация производилась следующим образом:

- Формировался layout, последовательно применяя следующие алгоритмы: grid, fcose, spread
- На основе полученного графа, у нод считалась нормализированная Closeness centrality
- Осуществлялась сама кластеризация через алгоритм kMeans по значению closeness у нод
- Нодам ставится цвет самого большого кластера, к которому они принадлежат

Группа "A" (обрезанно до 5000 пользователей), при k=50 получилось 25 кластеров (из более 2-х элементов)

![](https://i.imgur.com/tGibbIt.png)

Группа "B" (обрезанно до 1600 пользователей), при k=50 получилось 24 кластеров (из более 2-х элементов)

![](https://i.imgur.com/4Oev7a5.png)


## Getting VK API key

1. Make sure that app is enabled at [dev.vk.com - My Apps - Settings - App status](https://vk.com/editapp?id=51591070&section=options)
2. Run following snippet in Browser console:

```js
window.open("https://oauth.vk.com/authorize?client_id=51591070&display=page&redirect_uri=http://127.0.0.1:5173&scope=1026&response_type=token&v=5.131&state=123456");
```

3. Copy api key from url in newly opened tab. 
   - It starts just after `...access_token=` 
   - It ends just before `&expires_in=86400...`
4. Put key into `secrets/api.json` like this:
```js
{
    "api": "vk1.a.seAyNJUtqjJhVcvMMWk6NDO7ACF5YoNS-JzPAqAYN9wcybnDkrMpC_dvIkjx7hlSlfSxebtioYIRsovyi-aQXjoNytBwR14TB37HXJijDhzRXXE6SPG-g4wnwHXxDAic-ncCZ-DnVsyjaZOEEtxaqz7x0hwXMxkgJB0yYhMDwBqpLlwFt8HhsZ9guMG_zQwCM5m4_Z3SKXgV1fmpqv-6pQ"
}
```