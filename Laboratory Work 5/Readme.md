# Лабораторная работа 5
> K33401 - Рейнгеверц Вадим
>

Для того, чтобы строить прогнозы о дальнейшем поведении сообщества, будет полезно определить, по принципу какой модели строятся отношения между его участниками. 
- Для выполнения работы вам понадобятся социальные графы, отражающие взаимоотношения участников 2 сообществ социальной сети Вконтакте 
- Можно использовать сформированные в ходе выполнения первой лабораторной работы. 


[Полезные материалы](http://leonidzhukov.net/hse/2014/socialnetworks/)

## Сообщества

#### "A" group (5000 нод, 957 связей)
Group ID: ij_salt

Owner ID: -204380239

![](https://i.imgur.com/OMgukiH.png)

![](https://i.imgur.com/iGdiUBd.jpeg)


#### "B" group (1600 нод, 4818 связей)
Group ID: itmem

Owner ID: -127149194

![](https://i.imgur.com/86oXhVa.png)

![](https://i.imgur.com/56VhZ8V.png)

## 1. Постройте функции распределения степеней узлов для обоих сообществ
> На какую из известных вам функций похожа каждая из них? В отчёте отразите формулу, график.

Распределение степеней графа $P(k)$ определяется как доля узлов, имеющих степень $k$

Т.е. если в общей сложности $n$ узлов в сети и из них $n_k$ имеют степень $k$, то:

$\displaystyle P(k)=\frac{n_k}{n}$

Для "A" группы:

![](https://i.imgur.com/4ZM9gBH.png)

Для "B" группы:

![](https://i.imgur.com/9OFT9X2.png)

В обоих случаях функции напоминают $\displaystyle y=\frac{1}{x}$

- Power law
- С длинным хвостом

[Релевантный сниппет](./core/main.js#L325)

![](https://i.imgur.com/a4JJmHm.png)

### Reference
- [Распределение степеней](https://ru.wikipedia.org/wiki/%D0%A0%D0%B0%D1%81%D0%BF%D1%80%D0%B5%D0%B4%D0%B5%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%81%D1%82%D0%B5%D0%BF%D0%B5%D0%BD%D0%B5%D0%B9?useskin=vector)

## 2. Вычислите кластерные коэффициенты обоих сообществ
> **Кластерный коэффициент** (локальная плотность) ― вероятность того, что два соседа в графе связаны между собой

По формуле $\displaystyle C_i = \frac{2n_i}{k_i(k_i - 1)}$, где

$i$ ― нода

$k_i$ ― соседи ноды

$n_{i}$ ― число связей между соседями ноды

считаем для всех нод, и берем среднее. 

В итоге:

Для "A" группы:

![](https://i.imgur.com/4betFh9.png)


Для "B" группы:

![](https://i.imgur.com/OXhfLiY.png)


[Релевантный сниппет](./core/main.js#L392)

![](https://i.imgur.com/YTnatuK.png)

### Reference
- [Кластерный коэффициент](https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%BC%D0%BF%D0%BB%D0%B5%D0%BA%D1%81%D0%BD%D1%8B%D0%B5_%D1%81%D0%B5%D1%82%D0%B8?useskin=vector#%D0%9A%D0%BB%D0%B0%D1%81%D1%82%D0%B5%D1%80%D0%BD%D1%8B%D0%B9_%D0%BA%D0%BE%D1%8D%D1%84%D1%84%D0%B8%D1%86%D0%B8%D0%B5%D0%BD%D1%82)


## 3. Вычислите среднюю длину пути обоих графов

Для вычисление средней длины пути было осуществленно по следующему алгоритму:

1. Производилась итерация по всем нодам графа
2. Для итерируемой ноды находился компонент, к которому она принадлежала (все потомки по связям)
3. Находились наикратчайшие пути по алгоритму **Floyd-Warshall** между итерируемой ноды и нодами компонента
4. Полученные длины путей добавляются в массив и в конце суммируются
5. Сумма вставлялась в формулу средней длины пути: 

$\displaystyle l_G=\frac{1}{n(n-1)}\sum d(v_i, j_i)$, где

$n$ ― количество нод

Для "A" группы:

![](https://i.imgur.com/NjkWPxf.png)

Для "B" группы:

![](https://i.imgur.com/H1aiXdl.png)

[Релевантный сниппет](./core/main.js#L416)

![](https://i.imgur.com/37ugT22.png)

### Reference
- [Average path length](https://en.wikipedia.org/wiki/Average_path_length?useskin=vector#Definition)


## 4. Изучите существующие модели социальных сетей
> Каковы характерные для них диапазоны оценок? 
> Какую (или какие) из них напоминают исследуемые графы?

> **Note**
> 
> На практике не всегда получается подогнать сообщество под одну из существующих моделей, но вычисленные вами метрики помогут оценить сходство. 
> 
> Оцените:
> - Попадают ли получившиеся значения метрик в диапазоны оценок известных моделей
> - С какой точностью определены характерные значения в вашем случае. 
> 
> В этом вам может помочь следующая таблица:
> ![](https://i.imgur.com/tg8ADUX.png)


### Для "B" группы:

- Функции **распределения степеней узлов** $P(k)$ следует **power of law** (с длинным хвостом), что: 
  - Соответствует **Barabasi–Albert model (BA)**
  - Соответствует **Empirical model**
  - Не характерно для **Erdos–Renyi random model (ER)**, **Watts–Strogatz model (WS)** 
    - В этих моделях $P(k)$ следует **Poisson degree distribution**
- Минимальное значение **степени ноды** $\delta(G)=0$, что:
  - Исключает **BA**, **WS**
    - В этих моделях у каждой ноды как минимум одна связь
- Относительно большое значение **кластерного коэффициента** ($C=0.480$) при **средней степени нод** $d_{avg}(G)=6.023$, что:
  - Исключает **ER** 
    - Cвязи формируются равномерно/случайно ― маловероятно формирование кластеров
    - $C=\frac{d_{avg}(G)}{n}=\frac{6.023}{1600}=0.004$
  - Не характерно для **BA**
    - $C=n^{-0.75}=1600^{-0.75}= 0.004$
  - Исключает **WS**
    - Cвязи формируются равномерно/случайно ― маловероятно формирование кластеров
  - Соответствует **Empirical model**
    - $C~$~ *large*
- Короткая **средняя длина пути** ($l_G=2.416$), что:
  - Соответствует **ER**
    - $l_G=\frac{\log n}{\log d_{avg}(G)}=\frac{\log 1600}{\log 6.023}=4.110$
  - Соответствует  **BA**
    - $l_G=\frac{\log n}{\log (\log n)}=\frac{\log 1600}{\log (\log 1600)}=6.336$
  - Соответствует **WS**
    - $l_G=\log n=\log 1600 = 3.204$
  - Соответствует **Empirical model**
    - $l_G~$~ *small*

На основе проведенного анализа, и того что **ER**, **WS** и **BA** модели ― теоретические, упрощенные модели; делаем вывод, что **эмпирическая модель** лучше всего описывает сеть "B" группы


### Для "A" группы:

- Функции **распределения степеней узлов** $P(k)$ следует **power of law** (с длинным хвостом), что: 
  - Соответствует **Barabasi–Albert model (BA)**
  - Соответствует **Empirical model**
  - Не характерно для **Erdos–Renyi random model (ER)**, **Watts–Strogatz model (WS)** 
    - В этих моделях $P(k)$ следует **Poisson degree distribution**
- Минимальное значение **степени ноды** $\delta(G)=0$, что:
  - Исключает **BA**, **WS**
    - В этих моделях у каждой ноды как минимум одна связь
- Относительно большое значение **кластерного коэффициента** ($C=0.122$) при **средней степени нод** $d_{avg}(G)=0.383$, что:
  - Исключает **ER** 
    - Cвязи формируются равномерно/случайно ― маловероятно формирование кластеров
    - $C=\frac{d_{avg}(G)}{n}=\frac{0.383}{1600}=0.0003$
  - Не характерно для **BA**
    - $C=n^{-0.75}=5000^{-0.75}=0.002$
  - Исключает **WS**
    - Cвязи формируются равномерно/случайно ― маловероятно формирование кластеров
  - Соответствует **Empirical model**
    - $C~$~ *large*
- Короткая **средняя длина пути** ($l_G=0.005$), что:
  - (???) **ER** 
    - $l_G=\frac{\log n}{\log d_{avg}(G)}=\frac{\log 5000}{\log 0.383}=-8.875$
      - (формула для не работает т.к. $d_{avg}(G) < 1$)
  - Не характерно для **BA**
    - $l_G=\frac{\log n}{\log (\log n)}=\frac{\log 5000}{\log (\log 5000)}=6.511$
  - Не характерно **WS**
    - $l_G=\log n=\log 5000 = 3.699$
  - Соответствует **Empirical model**
    - $l_G~$~ *small*

На основе проведенного анализа, и того что **ER**, **WS** и **BA** модели ― теоретические, упрощенные модели; делаем вывод, что **эмпирическая модель** лучше всего описывает данную сеть "A" группы


## Getting VK API key

1. Make sure that app is enabled at [dev.vk.com - My Apps - Settings - App status](https://vk.com/editapp?id=51591070&section=options)
2. Run following snippet in Browser console:

```js
window.open("https://oauth.vk.com/authorize?client_id=51591070&display=page&redirect_uri=http://127.0.0.1:5173&scope=1026&response_type=token&v=5.131&state=123456");
```

3. Copy api key from url in newly opened tab. 
   - It starts just after `...access_token=` 
   - It ends just before `&expires_in=86400...`
4. Put key into `secrets/api.json` like this:
```js
{
    "api": "vk1.a.seAyNJUtqjJhVcvMMWk6NDO7ACF5YoNS-JzPAqAYN9wcybnDkrMpC_dvIkjx7hlSlfSxebtioYIRsovyi-aQXjoNytBwR14TB37HXJijDhzRXXE6SPG-g4wnwHXxDAic-ncCZ-DnVsyjaZOEEtxaqz7x0hwXMxkgJB0yYhMDwBqpLlwFt8HhsZ9guMG_zQwCM5m4_Z3SKXgV1fmpqv-6pQ"
}
```